{% extends "base.html" %}

{% block title %}Dashboard Aprobador - EU-UTVT{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/aprobador.css?v=2.2">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block content %}
<div class="aprobador-dashboard">
    <!-- Header del Dashboard -->
    <div class="dashboard-header">
        <div class="header-content">
            <div class="header-left">
                <h1 class="dashboard-title">
                    <i class="fas fa-clipboard-check"></i>
                    Dashboard de Aprobaciones
                </h1>
                <p class="dashboard-subtitle">
                    Gestión de Solicitudes Pendientes
                </p>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <i class="fas fa-user-circle"></i>
                    <span id="user-name">Cargando...</span>
                    <span class="user-role">Aprobador</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Tarjetas de Estadísticas -->
    <div class="stats-container">
        <div class="stat-card stat-pendientes">
            <div class="stat-icon">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-value" id="stat-pendientes">0</h3>
                <p class="stat-label">Solicitudes Pendientes</p>
            </div>
        </div>

        <div class="stat-card stat-aprobadas">
            <div class="stat-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-value" id="stat-aprobadas">0</h3>
                <p class="stat-label">Aprobadas por Mí</p>
            </div>
        </div>

        <div class="stat-card stat-rechazadas">
            <div class="stat-icon">
                <i class="fas fa-times-circle"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-value" id="stat-rechazadas">0</h3>
                <p class="stat-label">Rechazadas por Mí</p>
            </div>
        </div>

        <div class="stat-card stat-monto">
            <div class="stat-icon">
                <i class="fas fa-money-bill-wave"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-value" id="stat-monto">$0</h3>
                <p class="stat-label">Monto Pendiente</p>
            </div>
        </div>
    </div>

    <!-- Filtros y Búsqueda -->
    <div class="filters-section">
        <!-- Pestañas de Navegación -->
        <div class="tabs-navigation">
            <button class="tab-button active" data-tab="pendientes" onclick="cambiarVista('pendientes')">
                <i class="fas fa-clock"></i>
                Solicitudes Pendientes
            </button>
            <button class="tab-button" data-tab="historial" onclick="cambiarVista('historial')">
                <i class="fas fa-history"></i>
                Mi Historial
            </button>
        </div>

        <!-- Filtros para Pendientes -->
        <div class="filters-container" id="filtros-pendientes">
            <div class="filter-group">
                <label for="filter-departamento">
                    <i class="fas fa-building"></i>
                    Departamento
                </label>
                <select id="filter-departamento" class="filter-select">
                    <option value="">Todos los departamentos</option>
                    <option value="Rectoría">Rectoría</option>
                    <option value="Dirección Académica">Dirección Académica</option>
                    <option value="Dirección Administrativa">Dirección Administrativa</option>
                    <option value="Finanzas">Finanzas</option>
                    <option value="Recursos Humanos">Recursos Humanos</option>
                    <option value="Sistemas y TI">Sistemas y TI</option>
                    <option value="Mantenimiento">Mantenimiento</option>
                    <option value="Biblioteca">Biblioteca</option>
                    <option value="Servicios Escolares">Servicios Escolares</option>
                    <option value="Vinculación">Vinculación</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="filter-tipo-pago">
                    <i class="fas fa-tags"></i>
                    Tipo de Pago
                </label>
                <select id="filter-tipo-pago" class="filter-select">
                    <option value="">Todos los tipos</option>
                    <option value="Proveedores">Proveedores</option>
                    <option value="Póliza - Seguro">Póliza - Seguro</option>
                    <option value="Donativos">Donativos</option>
                    <option value="Operativos">Operativos</option>
                    <option value="Fiscales y Legales">Fiscales y Legales</option>
                </select>
            </div>

            <div class="filter-group">
                <button id="btn-aplicar-filtros" class="btn btn-primary">
                    <i class="fas fa-filter"></i>
                    Aplicar Filtros
                </button>
            </div>

            <div class="filter-group">
                <button id="btn-limpiar-filtros" class="btn btn-secondary">
                    <i class="fas fa-eraser"></i>
                    Limpiar
                </button>
            </div>

            <div class="filter-group ml-auto">
                <button id="btn-refrescar" class="btn btn-refresh">
                    <i class="fas fa-sync-alt"></i>
                    Refrescar
                </button>
            </div>
        </div>

        <!-- Filtros para Historial -->
        <div class="filters-container" id="filtros-historial" style="display: none;">
            <div class="filter-group">
                <label for="filter-historial-estado">
                    <i class="fas fa-tasks"></i>
                    Estado
                </label>
                <select id="filter-historial-estado" class="filter-select">
                    <option value="">Todos los estados</option>
                    <option value="aprobada">Aprobadas</option>
                    <option value="rechazada">Rechazadas</option>
                    <option value="pagada">Pagadas</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="filter-historial-departamento">
                    <i class="fas fa-building"></i>
                    Departamento
                </label>
                <select id="filter-historial-departamento" class="filter-select">
                    <option value="">Todos los departamentos</option>
                    <option value="Rectoría">Rectoría</option>
                    <option value="Dirección Académica">Dirección Académica</option>
                    <option value="Dirección Administrativa">Dirección Administrativa</option>
                    <option value="Finanzas">Finanzas</option>
                    <option value="Recursos Humanos">Recursos Humanos</option>
                    <option value="Sistemas y TI">Sistemas y TI</option>
                    <option value="Mantenimiento">Mantenimiento</option>
                    <option value="Biblioteca">Biblioteca</option>
                    <option value="Servicios Escolares">Servicios Escolares</option>
                    <option value="Vinculación">Vinculación</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="filter-historial-tipo-pago">
                    <i class="fas fa-tags"></i>
                    Tipo de Pago
                </label>
                <select id="filter-historial-tipo-pago" class="filter-select">
                    <option value="">Todos los tipos</option>
                    <option value="Proveedores">Proveedores</option>
                    <option value="Póliza - Seguro">Póliza - Seguro</option>
                    <option value="Donativos">Donativos</option>
                    <option value="Operativos">Operativos</option>
                    <option value="Fiscales y Legales">Fiscales y Legales</option>
                </select>
            </div>

            <div class="filter-group">
                <button id="btn-aplicar-filtros-historial" class="btn btn-primary">
                    <i class="fas fa-filter"></i>
                    Aplicar Filtros
                </button>
            </div>

            <div class="filter-group">
                <button id="btn-limpiar-filtros-historial" class="btn btn-secondary">
                    <i class="fas fa-eraser"></i>
                    Limpiar
                </button>
            </div>

            <div class="filter-group ml-auto">
                <button id="btn-refrescar-historial" class="btn btn-refresh">
                    <i class="fas fa-sync-alt"></i>
                    Refrescar
                </button>
            </div>
        </div>
    </div>

    <!-- Tabla de Solicitudes Pendientes -->
    <div class="table-section" id="seccion-pendientes">
        <div class="table-header">
            <h2 class="table-title">
                <i class="fas fa-list"></i>
                Solicitudes Pendientes de Aprobación
            </h2>
            <div class="table-info">
                <span id="total-solicitudes">0 solicitudes</span>
            </div>
        </div>

        <div class="table-container">
            <table class="solicitudes-table" id="tabla-solicitudes">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Fecha</th>
                        <th>Solicitante</th>
                        <th>Departamento</th>
                        <th>Beneficiario</th>
                        <th>Monto</th>
                        <th>Tipo de Pago</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="tbody-solicitudes">
                    <tr class="loading-row">
                        <td colspan="9" class="text-center">
                            <div class="loading-spinner">
                                <i class="fas fa-spinner fa-spin"></i>
                                Cargando solicitudes...
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Tabla de Historial -->
    <div class="table-section" id="seccion-historial" style="display: none;">
        <div class="table-header">
            <h2 class="table-title">
                <i class="fas fa-history"></i>
                Mi Historial de Aprobaciones y Rechazos
            </h2>
            <div class="table-info">
                <span id="total-historial">0 solicitudes</span>
            </div>
        </div>

        <div class="table-container">
            <table class="solicitudes-table" id="tabla-historial">
                <thead>
                    <tr>
                        <th>Folio</th>
                        <th>Fecha Procesada</th>
                        <th>Solicitante</th>
                        <th>Departamento</th>
                        <th>Beneficiario</th>
                        <th>Monto</th>
                        <th>Tipo de Pago</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="tbody-historial">
                    <tr class="loading-row">
                        <td colspan="9" class="text-center">
                            <div class="loading-spinner">
                                <i class="fas fa-spinner fa-spin"></i>
                                Cargando historial...
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal Ver Detalles -->
<div id="modal-detalles" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h2 class="modal-title">
                <i class="fas fa-file-alt"></i>
                Detalles de la Solicitud
            </h2>
            <button class="modal-close" data-modal="modal-detalles">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body" id="detalles-content">
            <!-- Contenido dinámico -->
        </div>
    </div>
</div>

<!-- Modal Aprobar -->
<div id="modal-aprobar" class="modal">
    <div class="modal-content">
        <div class="modal-header modal-success">
            <h2 class="modal-title">
                <i class="fas fa-check-circle"></i>
                Aprobar Solicitud
            </h2>
            <button class="modal-close" data-modal="modal-aprobar">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="confirmation-message">
                <i class="fas fa-question-circle"></i>
                <p>¿Está seguro que desea <strong>APROBAR</strong> esta solicitud?</p>
                <p class="solicitud-info" id="aprobar-solicitud-info"></p>
            </div>

            <div class="form-group">
                <label for="aprobar-comentarios">
                    <i class="fas fa-comment"></i>
                    Comentarios (Opcional)
                </label>
                <textarea 
                    id="aprobar-comentarios" 
                    class="form-control" 
                    rows="4"
                    placeholder="Agregue comentarios adicionales si lo desea..."
                    maxlength="500"
                ></textarea>
                <small class="form-text">Máximo 500 caracteres</small>
            </div>

            <input type="hidden" id="aprobar-solicitud-id">
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-modal="modal-aprobar">
                <i class="fas fa-times"></i>
                Cancelar
            </button>
            <button id="btn-confirmar-aprobar" class="btn btn-success">
                <i class="fas fa-check"></i>
                Aprobar Solicitud
            </button>
        </div>
    </div>
</div>

<!-- Modal Rechazar -->
<div id="modal-rechazar" class="modal">
    <div class="modal-content">
        <div class="modal-header modal-danger">
            <h2 class="modal-title">
                <i class="fas fa-times-circle"></i>
                Rechazar Solicitud
            </h2>
            <button class="modal-close" data-modal="modal-rechazar">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="confirmation-message alert-danger">
                <i class="fas fa-exclamation-triangle"></i>
                <p>¿Está seguro que desea <strong>RECHAZAR</strong> esta solicitud?</p>
                <p class="solicitud-info" id="rechazar-solicitud-info"></p>
            </div>

            <div class="form-group">
                <label for="rechazar-comentarios" class="required">
                    <i class="fas fa-comment-dots"></i>
                    Motivo del Rechazo (Obligatorio)
                </label>
                <textarea 
                    id="rechazar-comentarios" 
                    class="form-control" 
                    rows="5"
                    placeholder="Debe especificar claramente el motivo del rechazo (mínimo 10 caracteres)..."
                    minlength="10"
                    maxlength="500"
                    required
                ></textarea>
                <small class="form-text text-danger">
                    * Es obligatorio proporcionar un motivo detallado del rechazo
                </small>
                <small class="form-text">
                    Mínimo 10 caracteres, máximo 500
                </small>
            </div>

            <input type="hidden" id="rechazar-solicitud-id">
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-modal="modal-rechazar">
                <i class="fas fa-times"></i>
                Cancelar
            </button>
            <button id="btn-confirmar-rechazar" class="btn btn-danger">
                <i class="fas fa-ban"></i>
                Rechazar Solicitud
            </button>
        </div>
    </div>
</div>

<!-- Notificaciones Toast -->
<div id="toast-container" class="toast-container"></div>

{% endblock %}

{% block scripts %}
<script src="/static/js/aprobador.js?v=2.4"></script>
{% endblock %}
